{% extends "base.html" %}

{% block title %}Sign Up - SAFE-Step{% endblock %}

{% block body_class %}sign-up-page{% endblock %}

{% block content %}
<div class="login-bg min-vh-100 d-flex align-items-center" style="position:relative;">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-6">
                <div class="login-card card shadow-lg" style="margin: 2.5rem 0;">
                    <div class="card-body p-5">
                        <div class="text-center mb-4">
                            <div class="login-logo mb-3">
                                <i class="fas fa-shield-alt me-2"></i>SAFE-Step
                            </div>
                            <h2 class="h5 login-title">Create Your Account</h2>
                            <p class="login-subtitle">Join the SAFE-Step community</p>
                        </div>

                        {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                        {% for category, message in messages %}
                        <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show"
                            role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                        {% endfor %}
                        {% endif %}
                        {% endwith %}
                        <form method="POST" class="needs-validation" novalidate id="registerForm">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="first_name" class="form-label text-dark">First Name</label>
                                    <input type="text" class="form-control" id="first_name" name="first_name"
                                        placeholder="Enter your first name" required>
                                    <div class="invalid-feedback">
                                        Please enter your first name.
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="last_name" class="form-label text-dark">Last Name</label>
                                    <input type="text" class="form-control" id="last_name" name="last_name"
                                        placeholder="Enter your last name" required>
                                    <div class="invalid-feedback">
                                        Please enter your last name.
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="userType" class="form-label text-dark">User Type</label>
                                <select class="form-select" id="userType" name="userType" required>
                                    <option value="">Select your role...</option>
                                    <option value="caregiver">Caregiver</option>
                                    <option value="admin">Administrator</option>
                                </select>
                                <div class="invalid-feedback">
                                    Please select your user type.
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="username" class="form-label text-dark">MINDS ID</label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-user"></i>
                                    </span>
                                    <input type="text" class="form-control" id="username" name="username"
                                        placeholder="Choose your MINDS ID" required>
                                    <div class="invalid-feedback">
                                        Please choose a username.
                                    </div>
                                </div>
                                <div class="form-text">Username must be unique and at least 3 characters long.</div>
                            </div>

                            <div class="mb-3">
                                <label for="email" class="form-label text-dark">Email Address</label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-envelope"></i>
                                    </span>
                                    <input type="email" class="form-control" id="email" name="email"
                                        placeholder="Enter your email address" required>
                                    <div class="invalid-feedback">
                                        Please enter a valid email address.
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="password" class="form-label text-dark">Password</label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-lock"></i>
                                    </span>
                                    <input type="password" class="form-control" id="password" name="password"
                                        placeholder="Create a secure password" required minlength="6">
                                    <button class="btn btn-outline-secondary" type="button"
                                        onclick="togglePassword('password')">
                                        <i class="fas fa-eye" id="toggleIcon1"></i>
                                    </button>
                                    <div class="invalid-feedback">
                                        Password must be at least 6 characters long.
                                    </div>
                                </div>
                                <div class="form-text">
                                    <div class="password-strength mt-2">
                                        <div class="progress" style="height: 5px;">
                                            <div class="progress-bar" id="passwordStrength" role="progressbar"></div>
                                        </div>
                                        <small id="passwordHelp" class="text-muted">Enter a password to see
                                            strength</small>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-4">
                                <label for="confirmPassword" class="form-label text-dark">Confirm Password</label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-lock"></i>
                                    </span>
                                    <input type="password" class="form-control" id="confirmPassword"
                                        name="confirmPassword" placeholder="Confirm your password" required>
                                    <button class="btn btn-outline-secondary" type="button"
                                        onclick="togglePassword('confirmPassword')">
                                        <i class="fas fa-eye" id="toggleIcon2"></i>
                                    </button>
                                    <div class="invalid-feedback">
                                        Passwords do not match.
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3 form-check">
                                <input type="checkbox" class="form-check-input" id="terms" name="terms" required>
                                <label class="form-check-label text-dark" for="terms">
                                    I agree to the <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal">Terms
                                        of Service</a>
                                    and <a href="#" data-bs-toggle="modal" data-bs-target="#privacyModal">Privacy
                                        Policy</a>
                                </label>
                                <div class="invalid-feedback">
                                    You must agree to the terms and conditions.
                                </div>
                            </div>

                            <div class="mb-3 form-check">
                                <input type="checkbox" class="form-check-input" id="newsletter">
                                <label class="form-check-label text-dark" for="newsletter">
                                    Send me updates about new features and training materials
                                </label>
                            </div>

                            <div class="d-grid mb-3">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="fas fa-user-plus me-2"></i>Create Account
                                </button>
                            </div>
                        </form>

                        <hr class="my-4">

                        <div class="text-center">
                            <p class="text-muted mb-2">Already have an account?</p>
                            <a href="{{ url_for('login') }}" class="btn btn-outline-primary">
                                <i class="fas fa-sign-in-alt me-2"></i>Sign In
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Terms Modal -->
<div class="modal fade" id="termsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Terms of Service</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <h6>1. Acceptance of Terms</h6>
                <p>By accessing and using the Safe-Step platform, you accept and agree to be bound by the terms and
                    provision of this agreement.</p>

                <h6>2. Medical Disclaimer</h6>
                <p>Safe-Step is a monitoring tool and should not replace professional medical advice, diagnosis, or
                    treatment. Always seek the advice of your physician with any questions regarding a medical
                    condition.</p>

                <h6>3. Data Privacy</h6>
                <p>We are committed to protecting your privacy and handling your data in accordance with applicable
                    privacy laws and our Privacy Policy.</p>

                <h6>4. Emergency Situations</h6>
                <p>In case of a medical emergency, contact emergency services immediately. Safe-Step is not a
                    replacement for emergency medical services.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Privacy Modal -->
<div class="modal fade" id="privacyModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Privacy Policy</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <h6>Information We Collect</h6>
                <p>We collect information you provide directly to us, such as when you create an account, update your
                    profile, or contact us for support.</p>

                <h6>How We Use Your Information</h6>
                <p>We use the information we collect to provide, maintain, and improve our services, process
                    transactions, and communicate with you.</p>

                <h6>Information Sharing</h6>
                <p>We do not sell, trade, or otherwise transfer your personal information to third parties without your
                    consent, except as described in this policy.</p>

                <h6>Data Security</h6>
                <p>We implement appropriate security measures to protect your personal information against unauthorized
                    access, alteration, disclosure, or destruction.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
{% block extra_css %}
<style>
    /* Make background fixed for sign up page and add margin to form */
    .login-bg {
        background-attachment: fixed !important;
    }
</style>
{% endblock %}
<script>
    function togglePassword(inputId) {
        const passwordInput = document.getElementById(inputId);
        const iconNumber = inputId === 'password' ? '1' : '2';
        const toggleIcon = document.getElementById('toggleIcon' + iconNumber);

        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            toggleIcon.classList.remove('fa-eye');
            toggleIcon.classList.add('fa-eye-slash');
        } else {
            passwordInput.type = 'password';
            toggleIcon.classList.remove('fa-eye-slash');
            toggleIcon.classList.add('fa-eye');
        }
    }

    // Password strength checker
    document.getElementById('password').addEventListener('input', function () {
        const password = this.value;
        const strengthBar = document.getElementById('passwordStrength');
        const helpText = document.getElementById('passwordHelp');
        let strength = 0;
        let strengthText = '';
        let strengthClass = '';

        if (password.length >= 6) strength += 25;
        if (password.match(/[a-z]+/)) strength += 25;
        if (password.match(/[A-Z]+/)) strength += 25;
        if (password.match(/[0-9]+/)) strength += 25;

        if (strength <= 25) {
            strengthText = 'Weak';
            strengthClass = 'bg-danger';
        } else if (strength <= 50) {
            strengthText = 'Fair';
            strengthClass = 'bg-warning';
        } else if (strength <= 75) {
            strengthText = 'Good';
            strengthClass = 'bg-info';
        } else {
            strengthText = 'Strong';
            strengthClass = 'bg-success';
        }

        strengthBar.style.width = strength + '%';
        strengthBar.className = 'progress-bar ' + strengthClass;
        helpText.textContent = strengthText;
    });

    // Password confirmation validation
    document.getElementById('confirmPassword').addEventListener('input', function () {
        const password = document.getElementById('password').value;
        const confirmPassword = this.value;

        if (password !== confirmPassword) {
            this.setCustomValidity('Passwords do not match');
        } else {
            this.setCustomValidity('');
        }
    });

    // Form validation
    (function () {
        'use strict';
        window.addEventListener('load', function () {
            var forms = document.getElementsByClassName('needs-validation');
            var validation = Array.prototype.filter.call(forms, function (form) {
                form.addEventListener('submit', function (event) {
                    if (form.checkValidity() === false) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    form.classList.add('was-validated');
                }, false);
            });
        }, false);
    })();
</script>
{% endblock %}